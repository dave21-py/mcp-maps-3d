/**
 * MCP Maps 3D - Definitive ChatGPT-Style UI Theme
 *
 * This version perfects the UI to match the target screenshot:
 * - Enforces a sleek, dark-grey theme for the chat components.
 * - Fixes the minimize button visibility.
 * - Perfects the shape and size of the minimized input bar.
 */

 @import url('https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&display=swap');

 /* --- BASIC RESETS --- */
 * { box-sizing: border-box; margin: 0; padding: 0; }
 html { height: 100%; display: flex; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
 body { display: flex; flex: 1; margin: 0; overflow: hidden; }
 
 /* --- THEMING VARIABLES --- */
 :root {
   /* This is the new dark theme for the chat, inspired by ChatGPT */
   --chat-panel-bg: rgba(42, 42, 46, 0.8);      /* Dark semi-transparent grey */
   --chat-panel-border: rgba(255, 255, 255, 0.2);
   --chat-input-bg: rgba(60, 60, 64, 0.9);      /* Lighter grey for the input itself */
   --chat-input-text: #e0e0e0;
   --chat-placeholder-text: #9a9a9f;
   --chat-icon-color: #e0e0e0;                 /* Bright icon color for visibility */
   --chat-minimize-btn-bg: rgba(80, 80, 80, 0.7);
 
   /* Standard bubble colors */
   --user-bubble-bg: #007aff;
   --user-bubble-text: #ffffff;
   --assistant-bubble-bg: #2c2c2e;
   --assistant-bubble-text: #fff;
   --thinking-bubble-bg: #2c2c2e;
   --thinking-bubble-text: #98989d;
 }
 
 /* --- SCROLLBAR --- */
 ::-webkit-scrollbar { width: 8px; }
 ::-webkit-scrollbar-thumb { background: rgba(128, 128, 128, 0.5); border-radius: 4px; }
 ::-webkit-scrollbar-track { background: transparent; }
 
 /* --- CORE LAYOUT --- */
 #root, .gdm-map-app { height: 100vh; width: 100vw; overflow: hidden; position: relative; }
 .main-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
 #mapContainer { height: 100%; width: 100%; background-color: #e0e0e0; }
 
 /* --- CHAT PANEL (SIDEBAR) --- */
 .sidebar {
   position: absolute;
   z-index: 2;
   bottom: 20px;
   left: 50%;
   transform: translateX(-50%);
   
   /* MINIMIZED STATE (Default) */
   width: auto;
   max-width: 500px;
   
   /* Glassmorphism with our new dark theme */
   background-color: var(--chat-panel-bg);
   backdrop-filter: blur(20px) saturate(180%);
   -webkit-backdrop-filter: blur(20px) saturate(180%);
   border-radius: 24px;
   border: 1px solid var(--chat-panel-border);
   box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.15);
   
   display: flex;
   flex-direction: column-reverse;
   overflow: hidden;
   
   transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
 }
 
 /* EXPANDED STATE */
 .sidebar.chat-open {
   width: 95%;
   max-width: 800px;
   max-height: 60vh;
 }
 
 /* --- MINIMIZE BUTTON (FIXED VISIBILITY) --- */
 .minimize-chat-btn {
   position: absolute;
   top: 12px;
   right: 16px;
   width: 28px;
   height: 28px;
   border: none;
   background-color: var(--chat-minimize-btn-bg); /* Visible background */
   border-radius: 50%;
   cursor: pointer;
   display: flex;
   align-items: center;
   justify-content: center;
   z-index: 10;
   transition: background-color 0.2s;
 }
 .minimize-chat-btn:hover { background-color: rgba(100, 100, 100, 0.8); }
 .minimize-chat-btn svg { width: 20px; height: 20px; fill: var(--chat-icon-color); } /* Bright icon */
 
 /* --- CHAT MESSAGES --- */
 .chat-messages {
   overflow-y: auto;
   overflow-x: hidden;
   display: flex;
   flex-direction: column;
   gap: 16px;
   padding: 20px;
   padding-top: 50px;
   scroll-behavior: smooth;
 }
 #anchor { height: 1px; }
 
 /* --- BUBBLES --- */
 .turn { display: flex; flex-direction: column; max-width: 85%; }
 .turn > .text { padding: 10px 15px; border-radius: 18px; word-wrap: break-word; line-height: 1.5; }
 .role-user { align-self: flex-end; }
 .role-user > .text { background-color: var(--user-bubble-bg); color: var(--user-bubble-text); border-bottom-right-radius: 4px; }
 .role-assistant { align-self: flex-start; }
 .role-assistant > .text { background-color: var(--assistant-bubble-bg); color: var(--assistant-bubble-text); border-bottom-left-radius: 4px; }
 
 /* --- THINKING BUBBLES --- */
 .thinking { align-self: flex-start; width: 100%; font-style: italic; font-size: 0.9em; border-radius: 16px; background-color: var(--thinking-bubble-bg); color: var(--thinking-bubble-text); padding: 8px 12px; margin-top: 4px; border-bottom-left-radius: 4px; }
 .thinking summary { cursor: pointer; font-weight: 500; outline: none; }
 .thinking pre { margin-top: 8px; background: rgba(0,0,0,0.2) !important; font-size: 12px; padding: 10px !important; }
 .role-user .thinking { display: none; }
 
 /* --- INPUT AREA (REFINED) --- */
 .footer {
   padding: 8px; /* Reduced padding for a tighter look */
 }
 #inputArea {
   display: flex;
   align-items: center;
   gap: 8px;
   background-color: var(--chat-input-bg); /* Lighter than the panel */
   border-radius: 18px; /* Slightly less round */
   padding: 5px;
   padding-left: 15px;
   min-width: 450px;
 }
 #messageInput {
   flex-grow: 1;
   border: none;
   outline: none;
   background: transparent;
   font-size: 1rem;
   color: var(--chat-input-text);
   height: 34px; /* A bit taller */
 }
 #messageInput::placeholder { color: var(--chat-placeholder-text); }
 #sendButton {
   width: 34px; /* Match height */
   height: 34px;
   background-color: var(--user-bubble-bg);
   border: none;
   border-radius: 50%;
   cursor: pointer;
   display: flex;
   align-items: center;
   justify-content: center;
   flex-shrink: 0;
   transition: background-color 0.2s;
 }
 #sendButton svg { width: 18px; height: 18px; fill: #fff; transform: translateX(1px); }
 #sendButton.disabled { background-color: #5a5a5f; cursor: not-allowed; }
 
 /* --- UTILITIES --- */
 .hidden, .selector, .toolbar, #chatStatus { display: none !important; }
 
 /* --- RESPONSIVE --- */
 @media only screen and (max-width: 900px) {
   .sidebar.chat-open { width: 100%; max-height: 70vh; bottom: 0; left: 0; transform: none; border-radius: 24px 24px 0 0; }
   .sidebar:not(.chat-open) { width: 95%; }
   #inputArea { min-width: 0; }
 }
 
 /* --- CODE HIGHLIGHTING --- */
 pre code.hljs { display: block; overflow-x: auto; padding: 1em; background: #1c1b1b; color: #fff; border-radius: 10px; }
 .turn > .text code:not(pre code) { background-color: rgba(0,0,0,0.1); padding: 2px 5px; border-radius: 4px; }
 .hljs-comment{color:#999}.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-doctag,.hljs-section{color:#88aece}.hljs-attr{color:#88aece}.hljs-attribute{color:#c59bc1}.hljs-name,.hljs-type,.hljs-number,.hljs-selector-id,.hljs-quote,.hljs-template-tag{color:#f08d49}.hljs-selector-class{color:#88aece}.hljs-string,.hljs-regexp,.hljs-symbol,.hljs-variable,.hljs-template-variable,.hljs-link,.hljs-selector-attr{color:#b5bd68}.hljs-meta,.hljs-selector-pseudo{color:#88aece}.hljs-built_in,.hljs-title,.hljs-literal{color:#f08d49}.hljs-bullet,.hljs-code{color:#ccc}.hljs-meta .hljs-string{color:#b5bd68}.hljs-deletion{color:#de7176}.hljs-addition{color:#76c490}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:bold}